---
title: "Data Source"
---


Describe your data sources here.  
Include tables, descriptions, links to datasets, and any other relevant information about where your dashboard data comes from.

## Dati Istat con formato `SDMX`

SDMX (Statistical Data and Metadata eXchange) è uno standard internazionale (basato su sintassi XML (`SDMX-XML`) per lo scambio di dati statistici e metadati tra organizzazioni.

Rende possibile scaricare in formati: `SDMX-ML`, `SDMX-CSV`, `SDMX-JSON`, ecc.                                                                             
SDMX è un _"dataflow"_ che è però descritto da una certa struttura con dimensioni (territorio, tempo) e attributi (u. di misura) e classificazioni associate. 


A partire dal mese di ottobre 2022, l’Istat inizia a diffondere progressivamente i propri dati tramite [**IstatData**](https://esploradati.istat.it/databrowser/) (che sostituisce **I.Stat**), un nuovo sistema di diffusione interamente basato sulla `SDMX-RI`.

:::{.callout-warning}
C'è limite per singolo IP di 5 query al minuto oltre il quale viene attivato un blocco di accesso compreso tra 1 e 2 giorni.
:::

Concetti chiave:

+ `CategoryScheme` = la categoria tematica (es. servizi, ecc.)
  + sottotemi (es. turismo)
    + tabelle (es. arrivi e presenze turistiche)
    + `DataFlow` = i dati statistici (es. censimento popolazione)
    + `DataStructure` = struttura della tavola (spiega contenuto in termini di:
      + `Codelist` e 
      + `ConceptScheme`


Si può estrarre (con API rest) sempre sia `DATI` che `METADATI`:

<!-- + **OLD web service I.Stat**: [https://sdmx.istat.it/SDMXWS/rest/](https://sdmx.istat.it/SDMXWS/rest/) -->
<!--   - Dati:     [https://sdmx.istat.it/SDMXWS/rest/resource/](https://sdmx.istat.it/SDMXWS/rest/resource/) -->
<!--   - Metadati: [https://sdmx.istat.it/SDMXWS/rest/data/flowRef(DATAFLOW_ID)](https://sdmx.istat.it/SDMXWS/rest/data/flowRef(DATAFLOW_ID)) -->


+ **NEW web service IstatDATA**: [https://esploradati.istat.it/SDMXWS](https://esploradati.istat.it/SDMXWS)
  - Dati:     [https://esploradati.istat.it/SDMXWS/rest/data/](https://esploradati.istat.it/SDMXWS/rest/data/)
  - Metadati: [https://esploradati.istat.it/SDMXWS/rest/data/flowRef(DATAFLOW_ID)](https://esploradati.istat.it/SDMXWS/rest/data/flowRef(DATAFLOW_ID))

Esempio di URL per scaricare dati demografici (censimento 2023) per più comuni:

```{r}
#| eval: false
#| echo: false
#| output: false
comuni <- c(
  "034001", "034002", "034003", "034004", "034005", "034006", "034007", 
  "034008", "034009", "034010", "034011", "034012", "034013", "034014", 
  "034015", "034016", "034017", "034018", "034019", "034020", 
  "034021", # che non esiste
  "034022", "034023", "034024", "034025", "034026", "034027", "034028", 
  "034029", # che non esiste
  "034030", "034031", "034032", "034033", "034034", "034035", 
  "034036", "034037", "034038", "034039", "034040", "034041", "034042", 
  "034043", "034044", "034045", "034046", "034048", "034049", "034050", 
  "034051"
)

# WRITE FUNC: Funzione per scaricare dati ISTAT ----
anno = 2023
timeout_sec = 60

comuni_str <- paste(comuni, collapse = "+")
start_date <- paste0(anno, "-01-01")
end_date <- paste0(anno, "-12-31")

url <- paste0(
  "https://esploradati.istat.it/SDMXWS/rest/data/",
  "IT1,DF_DCSS_POP_DEMCITMIG_TV_2,1.0/",
  "A.", comuni_str, "......./",
  "ALL/?detail=full",
  "&startPeriod=", start_date,
  "&endPeriod=", end_date,
  "&dimensionAtObservation=TIME_PERIOD"
)
print(url)
```


> "https://esploradati.istat.it/SDMXWS/rest/data/IT1,DF_DCSS_POP_DEMCITMIG_TV_2,1.0/A.034001+034002+034003+034004+034005+034006+034007......./ALL/?detail=full&startPeriod=2023-01-01&endPeriod=2023-12-31&dimensionAtObservation=TIME_PERIOD"


## Variabili descrittive ISTAT limiti comunali e caratteristiche
Preso da output del file `map/00_carica_shp_situas.qmd`

#### [Tbl] Var desc `comuni_ita_info_sf`
```{r}
#| label: tbl-comuni-vardesc-ft
#| tbl-cap: "Descrizione variabili ISTAT limiti comunali e caratteristiche"
#| output: true

library(here)
source(here("R","f_ft_formatting.R"))

# leggi
comuni_ita_info_sf_VARDESC <- readRDS(
  here::here("data", "data_out", "tbl","comuni_ita_info_sf_VARDESC.rds")
)

# crea flextable
comuni_ita_info_sf_VARDESC_ft <- comuni_ita_info_sf_VARDESC |> 
flextable::flextable() |> 
  f_ft_word()

comuni_ita_info_sf_VARDESC_ft
```

